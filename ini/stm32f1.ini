#
# Marlin Firmware
# PlatformIO Configuration File
#

#################################
#
# STM32F1 Architecture with unified STM32 HAL
#
# Naming Example: STM32F103RCT6
#
#   F : Foundation (sometimes High Performance F2/F4)
#   1 : Cortex M3 core (0:M0, 1-2:M3, 3-4:M4, 7:M7)
#  03 : Line/Features
#   R : 64 or 66 pins  (T:36, C:48, V:100, Z:144, I:176)
#   C : 256KB Flash-memory  (B: 128KB, D:384KB, E:512KB, G:1024KB)
#   T : LQFP package
#   6 : -40...85°C   (7: ...105°C)
#
#################################

[common_STM32F103RC_variant]
extends              = stm32_variant
board                = genericSTM32F103RC
board_build.variant  = MARLIN_F103Rx
build_flags          = ${stm32_variant.build_flags} -DDEBUG_LEVEL=0
monitor_speed        = 115200

#
# STM32F103RE
#
[env:STM32F103RE]
extends       = common_stm32
board         = genericSTM32F103RE
monitor_speed = 115200

#
# Creality (STM32F103Rx)
#
[STM32F103Rx_creality]
extends                     = stm32_variant
board_build.variant         = MARLIN_F103Rx
board_build.offset          = 0x7000
board_upload.offset_address = 0x08007000
build_flags                 = ${stm32_variant.build_flags}
                              -DMCU_STM32F103RE -DHAL_SD_MODULE_ENABLED
                              -DSS_TIMER=4 -DTIMER_SERVO=TIM5
                              -DENABLE_HWSERIAL3 -DTRANSFER_CLOCK_DIV=8
build_unflags               = ${stm32_variant.build_unflags}
                              -DUSBCON -DUSBD_USE_CDC
extra_scripts               = ${stm32_variant.extra_scripts}
                              pre:buildroot/share/PlatformIO/scripts/random-bin.py
monitor_speed               = 115200
debug_tool                  = jlink
upload_protocol             = jlink

#
# Custom upload to SD via Marlin with Binary Protocol
#
[STM32F103Rx_creality_xfer]
extends         = STM32F103Rx_creality
build_flags     = ${STM32F103Rx_creality.build_flags} -DXFER_BUILD
extra_scripts   = ${STM32F103Rx_creality.extra_scripts}
                  pre:buildroot/share/scripts/upload.py
upload_protocol = custom

#
# Creality 512K (STM32F103RE)
#
[env:STM32F103RE_creality]
extends = STM32F103Rx_creality
board   = genericSTM32F103RE

[env:STM32F103RE_creality_xfer]
extends = STM32F103Rx_creality_xfer
board   = genericSTM32F103RE

#
# Creality 256K (STM32F103RC)
#
[env:STM32F103RC_creality]
extends = STM32F103Rx_creality
board   = genericSTM32F103RC

[env:STM32F103RC_creality_xfer]
extends = STM32F103Rx_creality_xfer
board   = genericSTM32F103RC

#
# BigTree SKR Mini E3 V2.0 & DIP / SKR CR6 (STM32F103RET6 ARM Cortex-M3)
#
#   STM32F103RE_btt ............. RET6
#   STM32F103RE_btt_USB ......... RET6 (USB mass storage)
#
[env:STM32F103RE_btt]
extends                     = stm32_variant
board                       = genericSTM32F103RE
board_build.variant         = MARLIN_F103Rx
board_build.offset          = 0x7000
board_upload.offset_address = 0x08007000
build_flags                 = ${stm32_variant.build_flags}
                              -DMCU_STM32F103RE -DHAL_SD_MODULE_ENABLED
                              -DSS_TIMER=4 -DTIMER_SERVO=TIM5
                              -DENABLE_HWSERIAL3 -DTRANSFER_CLOCK_DIV=8
monitor_speed               = 115200
debug_tool                  = jlink
upload_protocol             = jlink

[env:STM32F103RE_btt_USB]
extends           = env:STM32F103RE_btt
platform_packages = ${stm_flash_drive.platform_packages}
build_flags       = ${env:STM32F103RE_btt.build_flags}
                    -DUSE_USB_FS -DUSBD_IRQ_PRIO=5
                    -DUSBD_IRQ_SUBPRIO=6 -DUSBD_USE_CDC_MSC
build_unflags     = ${stm32_variant.build_unflags} -DUSBD_USE_CDC
